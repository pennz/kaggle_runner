
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Run kaggle kernels, for fast model prototyping." name="description"/>
<link href="https://mrcue.gitlab.io/kaggle_runner/kaggle_runner/datasets/data_handlers/" rel="canonical"/>
<link href="../../../assets/images/favicon.png" rel="shortcut icon"/>
<meta content="mkdocs-1.1.2, mkdocs-material-5.4.0" name="generator"/>
<title>data_handlers.py - kaggle runner</title>
<link href="../../../assets/stylesheets/main.fe0cca5b.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
<link href="../../../css/mkdocstrings.css" rel="stylesheet"/>
</head>
<body dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#kaggle_runner.datasets.data_handlers">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header-nav md-grid">
<a aria-label="kaggle runner" class="md-header-nav__button md-logo" href="https://mrcue.gitlab.io/kaggle_runner" title="kaggle runner">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"></path></svg>
</a>
<label class="md-header-nav__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header-nav__title" data-md-component="header-title">
<div class="md-header-nav__ellipsis">
<span class="md-header-nav__topic md-ellipsis">
            kaggle runner
          </span>
<span class="md-header-nav__topic md-ellipsis">
            
              data_handlers.py
            
          </span>
</div>
</div>
<label class="md-header-nav__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" data-md-state="active" name="query" placeholder="Search" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<button aria-label="Clear" class="md-search__icon md-icon" data-md-component="search-reset" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header-nav__source">
<a class="md-source" href="https://github.com/pennz/kaggle_runner/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    pennz/kaggle_runner
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="kaggle runner" class="md-nav__button md-logo" href="https://mrcue.gitlab.io/kaggle_runner" title="kaggle runner">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"></path></svg>
</a>
    kaggle runner
  </label>
<div class="md-nav__source">
<a class="md-source" href="https://github.com/pennz/kaggle_runner/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    pennz/kaggle_runner
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../.." title="Overview">
      Overview
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../credits/" title="Credits">
      Credits
    </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="nav-3" id="nav-3" type="checkbox"/>
<label class="md-nav__link" for="nav-3">
      kaggle_runner
      <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg>
</span>
</label>
<nav aria-label="kaggle_runner" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-3">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
        kaggle_runner
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../callbacks/" title="callbacks">
      callbacks
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../data_providers/" title="data_providers">
      data_providers
    </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="nav-3-3" id="nav-3-3" type="checkbox"/>
<label class="md-nav__link" for="nav-3-3">
      datasets
      <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg>
</span>
</label>
<nav aria-label="datasets" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="nav-3-3">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
        datasets
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../bert/" title="bert.py">
      bert.py
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../coders/" title="coders.py">
      coders.py
    </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<a class="md-nav__link md-nav__link--active" href="./" title="data_handlers.py">
      data_handlers.py
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../data_prepare/" title="data_prepare.py">
      data_prepare.py
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../jigsaw_toxic_data/" title="jigsaw_toxic_data.py">
      jigsaw_toxic_data.py
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../mock_dataset.md" title="mock_dataset.py">
      mock_dataset.py
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../siim_dataset/" title="siim_dataset.py">
      siim_dataset.py
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../transfomers/" title="transfomers.py">
      transfomers.py
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../defaults/" title="defaults">
      defaults
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-5" id="nav-3-5" type="checkbox"/>
<label class="md-nav__link" for="nav-3-5">
      kernels
      <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg>
</span>
</label>
<nav aria-label="kernels" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="nav-3-5">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
        kernels
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../kernels/KernelRunningState/" title="KernelRunningState.py">
      KernelRunningState.py
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../kernels/PSKernel/" title="PSKernel.py">
      PSKernel.py
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../kernels/Shonenkov/" title="Shonenkov.py">
      Shonenkov.py
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../kernels/bert/" title="bert.py">
      bert.py
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../kernels/bert_torch/" title="bert_torch.py">
      bert_torch.py
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../kernels/fastai_kernel/" title="fastai_kernel.py">
      fastai_kernel.py
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../kernels/kernel/" title="kernel.py">
      kernel.py
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../kernels/pytorchKernel/" title="pytorchKernel.py">
      pytorchKernel.py
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../logs/" title="logs">
      logs
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../losses/" title="losses">
      losses
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-8" id="nav-3-8" type="checkbox"/>
<label class="md-nav__link" for="nav-3-8">
      metrics
      <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg>
</span>
</label>
<nav aria-label="metrics" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="nav-3-8">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
        metrics
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../metrics/meters/" title="meters.py">
      meters.py
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../metrics/metrics/" title="metrics.py">
      metrics.py
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-9" id="nav-3-9" type="checkbox"/>
<label class="md-nav__link" for="nav-3-9">
      modules
      <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg>
</span>
</label>
<nav aria-label="modules" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="nav-3-9">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
        modules
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../modules/ToxicSimpleNNModel/" title="ToxicSimpleNNModel.py">
      ToxicSimpleNNModel.py
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../modules/attention/" title="attention.py">
      attention.py
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../optimizers/" title="optimizers">
      optimizers
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../plots/" title="plots">
      plots
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../post_processers/" title="post_processers">
      post_processers
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../predictors/" title="predictors">
      predictors
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-14" id="nav-3-14" type="checkbox"/>
<label class="md-nav__link" for="nav-3-14">
      runners
      <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg>
</span>
</label>
<nav aria-label="runners" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="nav-3-14">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
        runners
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../runners/coordinator/" title="coordinator.py">
      coordinator.py
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../runners/runner/" title="runner.py">
      runner.py
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../runners/tpu_trainer.md" title="tpu_trainer.py">
      tpu_trainer.py
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../runners/trainer/" title="trainer.py">
      trainer.py
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-15" id="nav-3-15" type="checkbox"/>
<label class="md-nav__link" for="nav-3-15">
      utils
      <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg>
</span>
</label>
<nav aria-label="utils" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="nav-3-15">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
        utils
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/kernel_utils/" title="kernel_utils.py">
      kernel_utils.py
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/tpu/" title="tpu.py">
      tpu.py
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/utils/" title="utils.py">
      utils.py
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/visualizer/" title="visualizer.py">
      visualizer.py
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/wrapper/" title="wrapper.py">
      wrapper.py
    </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
</nav>
</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/pennz/kaggle_runner/edit/master/docs/kaggle_runner/datasets/data_handlers.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"></path></svg>
</a>
<div class="doc doc-object doc-module">
<h2 class="hidden-toc" href="#kaggle_runner.datasets.data_handlers" id="kaggle_runner.datasets.data_handlers" style="visibility: hidden; width: 0; height: 0;">
<a class="headerlink" href="#kaggle_runner.datasets.data_handlers" title="Permanent link">¤</a></h2>
<div class="doc doc-contents first">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="kaggle_runner.datasets.data_handlers.PS_TF_DataHandler">
<code>PS_TF_DataHandler</code>
<a class="headerlink" href="#kaggle_runner.datasets.data_handlers.PS_TF_DataHandler" title="Permanent link">¤</a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="kaggle_runner.datasets.data_handlers.PS_TF_DataHandler.eval_input_fn">
<code class="highlight language-python">
eval_input_fn<span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">split_id</span><span class="p">,</span> <span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#kaggle_runner.datasets.data_handlers.PS_TF_DataHandler.eval_input_fn" title="Permanent link">¤</a></h3>
<div class="doc doc-contents">
<p>An input function for evaluation or prediction</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>features</code></td>
<td><code></code></td>
<td></td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>labels</code></td>
<td><code></code></td>
<td></td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>batch_size</code></td>
<td><code></code></td>
<td></td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>split_id</code></td>
<td><code></code></td>
<td></td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>n_splits</code></td>
<td><code></code></td>
<td>
<p>(Default value = 10)</p>
</td>
<td><code>10</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kaggle_runner/datasets/data_handlers.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">eval_input_fn</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">split_id</span><span class="p">,</span> <span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">"""An input function for evaluation or prediction</span>

<span class="sd">    Args:</span>
<span class="sd">      features: </span>
<span class="sd">      labels: </span>
<span class="sd">      batch_size: </span>
<span class="sd">      split_id: </span>
<span class="sd">      n_splits: (Default value = 10)</span>

<span class="sd">    Returns:</span>

<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">split_id</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">n_splits</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">split_id</span> <span class="o">&lt;</span> <span class="n">n_splits</span>
    <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># No labels, use only features.</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">features</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>

    <span class="c1"># Convert the inputs to a Dataset.</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">shard</span><span class="p">(</span><span class="n">n_splits</span><span class="p">,</span> <span class="n">split_id</span><span class="p">)</span>
    <span class="c1"># Batch the examples</span>
    <span class="k">assert</span> <span class="n">batch_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"batch_size must not be None"</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>

    <span class="c1"># Return the dataset.</span>
    <span class="k">return</span> <span class="n">ds</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="kaggle_runner.datasets.data_handlers.PS_TF_DataHandler.load_data">
<code class="highlight language-python">
load_data<span class="p">(</span><span class="n">train_path</span><span class="p">,</span> <span class="n">test_path</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#kaggle_runner.datasets.data_handlers.PS_TF_DataHandler.load_data" title="Permanent link">¤</a></h3>
<div class="doc doc-contents">
<p>Returns the iris dataset as (train_x, train_y), (test_x, test_y).</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>train_X_np</code></td>
<td><code></code></td>
<td></td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>train_Y_np)</code></td>
<td><code></code></td>
<td>
<h1 id="joindataset_dir">join(dataset_dir:<a class="headerlink" href="#joindataset_dir" title="Permanent link">¤</a></h1>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>'labels.csv')image_ds</code></td>
<td><code></code></td>
<td>
<p>(Default value = tf.data.Dataset.from_tensor_slices(train_X_np)image_mask_ds = tf.data.Dataset.from_tensor_slices(train_Y_np)return tf.data.Dataset.zip((image_ds)</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>image_mask_ds))@staticmethodload_data</code></td>
<td><code></code></td>
<td></td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>test_path</code></td>
<td><code></code></td>
<td></td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>train_Y_np)</code></td>
<td><code></code></td>
<td>
<h1 id="joindataset_dir">join(dataset_dir:<a class="headerlink" href="#joindataset_dir" title="Permanent link">¤</a></h1>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>image_mask_ds))@staticmethodload_data(train_path</code></td>
<td><code></code></td>
<td></td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kaggle_runner/datasets/data_handlers.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="n">train_path</span><span class="p">,</span> <span class="n">test_path</span><span class="p">):</span>
    <span class="sd">"""Returns the iris dataset as (train_x, train_y), (test_x, test_y).</span>

<span class="sd">    Args:</span>
<span class="sd">      train_X_np: </span>
<span class="sd">      train_Y_np): # join(dataset_dir:</span>
<span class="sd">      'labels.csv')image_ds: (Default value = tf.data.Dataset.from_tensor_slices(train_X_np)image_mask_ds = tf.data.Dataset.from_tensor_slices(train_Y_np)return tf.data.Dataset.zip((image_ds)</span>
<span class="sd">      image_mask_ds))@staticmethodload_data: </span>
<span class="sd">      test_path: </span>
<span class="sd">      train_Y_np):  # join(dataset_dir: </span>
<span class="sd">      image_mask_ds))@staticmethodload_data(train_path: </span>

<span class="sd">    Returns:</span>

<span class="sd">    """</span>
    <span class="c1"># train_path, test_path = maybe_download()</span>
    <span class="c1"># here the test is really no lable we need to do CV in train part</span>
    <span class="n">train_X</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">train_path</span><span class="p">,</span> <span class="s2">"rb"</span><span class="p">))</span>  <span class="c1"># (None, 2048)</span>
    <span class="c1"># (None, 2048) 2048 features from xception net</span>
    <span class="n">to_predict_X</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">test_path</span><span class="p">,</span> <span class="s2">"rb"</span><span class="p">))</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATASET_DIR</span><span class="p">,</span> <span class="s2">"labels.csv"</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATASET_DIR2</span><span class="p">,</span> <span class="s2">"labels.csv"</span><span class="p">))</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="s2">"breed"</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  <span class="c1"># for all training data</span>
    <span class="k">global</span> <span class="n">SPECIES</span>
    <span class="n">SPECIES</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">labels</span><span class="p">)))</span>
    <span class="n">_label_id_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">SPECIES</span><span class="p">))</span>
    <span class="n">train_y</span> <span class="o">=</span> <span class="p">[</span><span class="n">_label_id_map</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">),</span> <span class="n">to_predict_X</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="kaggle_runner.datasets.data_handlers.PS_TF_DataHandler.predict_input_fn">
<code class="highlight language-python">
predict_input_fn<span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#kaggle_runner.datasets.data_handlers.PS_TF_DataHandler.predict_input_fn" title="Permanent link">¤</a></h3>
<div class="doc doc-contents">
<p>An input function for evaluation or prediction</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>features</code></td>
<td><code></code></td>
<td></td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>batch_size</code></td>
<td><code></code></td>
<td></td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kaggle_runner/datasets/data_handlers.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">predict_input_fn</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
    <span class="sd">"""An input function for evaluation or prediction</span>

<span class="sd">    Args:</span>
<span class="sd">      features: </span>
<span class="sd">      batch_size: </span>

<span class="sd">    Returns:</span>

<span class="sd">    """</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">features</span>

    <span class="c1"># Convert the inputs to a Dataset.</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
    <span class="c1"># Batch the examples</span>
    <span class="k">assert</span> <span class="n">batch_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"batch_size must not be None"</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>

    <span class="c1"># Return the dataset.</span>
    <span class="k">return</span> <span class="n">ds</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="kaggle_runner.datasets.data_handlers.PS_TF_DataHandler.serialize_PS_example">
<code class="highlight language-python">
serialize_PS_example<span class="p">(</span><span class="n">feature0</span><span class="p">,</span> <span class="n">feature1</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#kaggle_runner.datasets.data_handlers.PS_TF_DataHandler.serialize_PS_example" title="Permanent link">¤</a></h3>
<div class="doc doc-contents">
<p>NOT WORKING... don't know why
Creates a tf.Example message ready to be written to a file.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>feature0</code></td>
<td><code></code></td>
<td></td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>feature1</code></td>
<td><code></code></td>
<td></td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kaggle_runner/datasets/data_handlers.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">serialize_PS_example</span><span class="p">(</span><span class="n">feature0</span><span class="p">,</span> <span class="n">feature1</span><span class="p">):</span>
    <span class="sd">"""NOT WORKING... don't know why</span>
<span class="sd">    Creates a tf.Example message ready to be written to a file.</span>

<span class="sd">    Args:</span>
<span class="sd">      feature0: </span>
<span class="sd">      feature1: </span>

<span class="sd">    Returns:</span>

<span class="sd">    """</span>
    <span class="c1"># Create a dictionary mapping the feature name to the</span>
    <span class="c1"># tf.Example-compatible data type.</span>
    <span class="k">assert</span> <span class="n">feature0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">feature0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">128</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">feature0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">feature1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="ow">and</span> <span class="n">feature0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">feature1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">f0</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">feature0</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">feature1</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">feature</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"image"</span><span class="p">:</span> <span class="n">_int64_feature_from_list</span><span class="p">(</span><span class="n">f0</span><span class="p">),</span>
        <span class="s2">"mask"</span><span class="p">:</span> <span class="n">_int64_feature_from_list</span><span class="p">(</span><span class="n">f1</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="c1"># Create a Features message using tf.train.Example.</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"in transforming to tf example proto"</span><span class="p">)</span>

    <span class="n">example_proto</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">Example</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">Features</span><span class="p">(</span><span class="n">feature</span><span class="o">=</span><span class="n">feature</span><span class="p">))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"after transforming one feature to tf example proto"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">example_proto</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="kaggle_runner.datasets.data_handlers.PS_TF_DataHandler.train_input_fn">
<code class="highlight language-python">
train_input_fn<span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">split_id</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
</span>
<a class="headerlink" href="#kaggle_runner.datasets.data_handlers.PS_TF_DataHandler.train_input_fn" title="Permanent link">¤</a></h3>
<div class="doc doc-contents">
<p>An input function for training</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>features</code></td>
<td><code></code></td>
<td></td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>labels</code></td>
<td><code></code></td>
<td></td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>batch_size</code></td>
<td><code></code></td>
<td></td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>split_id</code></td>
<td><code></code></td>
<td>
<p>(Default value = -1)</p>
</td>
<td><code>-1</code></td>
</tr>
<tr>
<td><code>n_splits</code></td>
<td><code></code></td>
<td>
<p>(Default value = 10)</p>
</td>
<td><code>10</code></td>
</tr>
<tr>
<td><code>cv</code></td>
<td><code></code></td>
<td>
<p>(Default value = True)</p>
</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kaggle_runner/datasets/data_handlers.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="nd">@staticmethod</span>
<span class="c1"># for these, we will need to extract all the points before:</span>
<span class="k">def</span> <span class="nf">train_input_fn</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">split_id</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">"""An input function for training</span>

<span class="sd">    Args:</span>
<span class="sd">      features: </span>
<span class="sd">      labels: </span>
<span class="sd">      batch_size: </span>
<span class="sd">      split_id: (Default value = -1)</span>
<span class="sd">      n_splits: (Default value = 10)</span>
<span class="sd">      cv: (Default value = True)</span>

<span class="sd">    Returns:</span>

<span class="sd">    """</span>
    <span class="c1"># read from the tfrecord file (save the extracted ones)(read the data)</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">cv</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">split_id</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">n_splits</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">split_id</span> <span class="o">&lt;</span> <span class="n">n_splits</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="p">[</span><span class="n">ds</span><span class="o">.</span><span class="n">shard</span><span class="p">(</span><span class="n">n_splits</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_splits</span><span class="p">)]</span>

        <span class="n">shards_cross</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ds</span><span class="p">[</span><span class="n">val_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">val_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_splits</span><span class="p">)</span> <span class="k">if</span> <span class="n">val_id</span> <span class="o">!=</span> <span class="n">split_id</span>
        <span class="p">]</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">shards_cross</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">shards_cross</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="c1"># just memory is not enough ...</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">buffer_size</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_splits</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_splits</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">buffer_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>
    <span class="c1"># after shuffle, we do cross validtation split</span>

    <span class="c1"># taken from Dan, https://stackoverflow.com/questions/39748660/how-to-perform-k-fold-cross-validation-with-tensorflow</span>
    <span class="c1"># will need to append id, then remove the id?</span>
    <span class="c1"># -&gt; no need, we just split to 5 shards, then rearrange these shards</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">repeat</span><span class="p">()</span>
    <span class="c1"># Batch the examples</span>
    <span class="k">assert</span> <span class="n">batch_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"batch_size must not be None"</span>
    <span class="c1"># Return the dataset.</span>
    <span class="k">return</span> <span class="n">ds</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span><span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav aria-label="Footer" class="md-footer-nav__inner md-grid">
<a class="md-footer-nav__link md-footer-nav__link--prev" href="../coders/" rel="prev" title="coders.py">
<div class="md-footer-nav__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer-nav__title">
<div class="md-ellipsis">
<span class="md-footer-nav__direction">
                  Previous
                </span>
                coders.py
              </div>
</div>
</a>
<a class="md-footer-nav__link md-footer-nav__link--next" href="../data_prepare/" rel="next" title="data_prepare.py">
<div class="md-footer-nav__title">
<div class="md-ellipsis">
<span class="md-footer-nav__direction">
                  Next
                </span>
                data_prepare.py
              </div>
</div>
<div class="md-footer-nav__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
</div>
</div>
</div>
</footer>
</div>
<script src="../../../assets/javascripts/vendor.d710d30a.min.js"></script>
<script src="../../../assets/javascripts/bundle.b39636ac.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
<script>
        app = initialize({
          base: "../../..",
          features: [],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.a68abb33.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
</body>
</html>